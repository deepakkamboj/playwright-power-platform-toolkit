# Architecture Overview

import { Cards, Card } from '../../components/Cards';
import { Package, Target, GitBranch, Wrench } from 'lucide-react';

The Playwright Power Platform Toolkit uses a layered architecture with factory and provider patterns to simplify testing Power Platform applications.

> **Quick Start:** New to the toolkit? Check out the [Getting Started Guide](/guide/getting-started) first.

## Architecture Layers

The toolkit provides three levels of abstraction for different use cases:

```mermaid
graph TB
    A[Customer Test Code] --> B[Level 1: AppProvider - Simplest API]
    A --> C[Level 2: AppLauncherFactory - Advanced]
    A --> D[Level 3: Page Objects - Full Control]

    B --> E[Factory & Launchers]
    C --> E
    D --> E

    E --> F[Canvas Apps]
    E --> G[Model Driven Apps]
    E --> H[Portal Apps - Future]

    style A fill:#e1f5ff
    style B fill:#c8e6c9
    style C fill:#fff9c4
    style D fill:#ffccbc
    style E fill:#e0e0e0
    style F fill:#bbdefb
    style G fill:#c5cae9
    style H fill:#f8bbd0
```

### Level 1: AppProvider (Recommended)

> **Best for:** Testing existing apps

The simplest API for launching and testing Power Platform apps.

```typescript
const provider = new AppProvider(page);
await provider.launch({ app: { id: 'app-id' }, type: AppType.Canvas });
await provider.click({ name: 'Submit' });
```

**[Learn more about AppProvider →](/architecture/patterns#pattern-1-appprovider-for-testing-recommended)**

### Level 2: AppLauncherFactory (Advanced)

> **Best for:** Custom launcher logic and advanced scenarios

Direct access to app launchers with caching and factory management.

```typescript
const launcher = AppLauncherFactory.getCanvasLauncher(page);
await launcher.launchById('app-id', baseUrl, AppLaunchMode.Play);
```

**[Learn more about Factory Pattern →](/architecture/patterns#pattern-2-factory-for-advanced-scenarios)**

### Level 3: Page Objects (Full Control)

> **Best for:** Creating new apps and studio operations

Direct access to page objects for maximum control and app creation capabilities.

```typescript
const powerApps = new PowerAppsPage(page);
await powerApps.canvas.createBlankCanvasApp('TestApp');
```

**[Learn more about Page Objects →](/architecture/patterns#pattern-3-powerappspage-for-app-creation)**

## System Architecture

```mermaid
graph TB
    subgraph "Customer Layer"
        TEST[Test Code]
    end

    subgraph "API Layer - Level 1"
        PROVIDER[AppProvider<br/>Simple unified API]
    end

    subgraph "Factory Layer - Level 2"
        FACTORY[AppLauncherFactory<br/>Creates launchers]
        INTERFACE[IAppLauncher<br/>Interface contract]
    end

    subgraph "Implementation Layer - Level 3"
        CANVAS[CanvasAppPage<br/>Canvas operations]
        MODEL[ModelDrivenAppPage<br/>MDA operations]
        PORTAL[PortalAppPage<br/>Portal operations]
        POWERAPP[PowerAppsPage<br/>Unified entry point]
    end

    subgraph "Supporting Layer"
        LOCATORS[Locators<br/>260+ selectors]
        TYPES[Types<br/>Interfaces & Enums]
        UTILS[Utilities<br/>30+ helpers]
    end

    subgraph "Playwright Layer"
        PLAYWRIGHT[Playwright Test Runner<br/>Browser automation]
    end

    subgraph "Application Layer"
        APPS[Power Platform Apps<br/>Canvas, Model Driven, Portal]
    end

    TEST --> PROVIDER
    TEST --> FACTORY
    TEST --> POWERAPP

    PROVIDER --> FACTORY
    FACTORY --> INTERFACE

    INTERFACE -.implements.-> CANVAS
    INTERFACE -.implements.-> MODEL
    INTERFACE -.implements.-> PORTAL

    POWERAPP --> CANVAS
    POWERAPP --> MODEL

    CANVAS --> LOCATORS
    CANVAS --> TYPES
    CANVAS --> UTILS

    MODEL --> LOCATORS
    MODEL --> TYPES
    MODEL --> UTILS

    CANVAS --> PLAYWRIGHT
    MODEL --> PLAYWRIGHT

    PLAYWRIGHT --> APPS

    style TEST fill:#e1f5ff
    style PROVIDER fill:#c8e6c9
    style FACTORY fill:#fff9c4
    style INTERFACE fill:#fff9c4
    style CANVAS fill:#bbdefb
    style MODEL fill:#c5cae9
    style PORTAL fill:#f8bbd0
    style POWERAPP fill:#b2dfdb
```

## Core Components

| Component              | Purpose                     | Learn More                                  |
| ---------------------- | --------------------------- | ------------------------------------------- |
| **AppProvider**        | Simplest API for customers  | [Usage Patterns](/architecture/patterns)    |
| **AppLauncherFactory** | Create and manage launchers | [Usage Patterns](/architecture/patterns)    |
| **PowerAppsPage**      | Unified entry point         | [Usage Patterns](/architecture/patterns)    |
| **CanvasAppPage**      | Canvas-specific operations  | [Core Components](/architecture/components) |
| **ModelDrivenAppPage** | Model Driven operations     | [Core Components](/architecture/components) |
| **IAppLauncher**       | Contract for all launchers  | [Core Components](/architecture/components) |

## Key Design Principles

### 1. Separation of Concerns

Each layer has a specific responsibility, making the toolkit easy to understand and maintain.

### 2. Extensibility

> **Tip:** Adding a new app type is easy! Just implement the `IAppLauncher` interface.

The factory pattern makes it simple to add support for new app types. See the [Extension Guide](/architecture/extending) for details.

### 3. Flexibility

Three levels of abstraction let you choose the right tool for the job:

- Simple tests? Use AppProvider
- Advanced scenarios? Use the Factory
- Maximum control? Use Page Objects directly

### 4. Type Safety

Full TypeScript support with interfaces and enums ensures compile-time safety and excellent IDE support.

### 5. Performance

Factory caching ensures launcher instances are reused for better performance.

## Quick Decision Guide

Not sure which pattern to use? Here's a quick guide:

```
Testing existing app by ID? → AppProvider ✅
Testing existing app by name? → AppProvider with PowerAppsPage ✅
Creating new app? → PowerAppsPage ✅
Need custom logic? → AppLauncherFactory ✅
Need maximum control? → Page Objects directly ✅
Adding new app type? → Implement IAppLauncher ✅
```

**[See detailed decision tree →](/architecture/patterns#decision-tree)**

## Explore the Architecture

<Cards cols={2}>
  <Card icon={<Package />} title="Core Components" href="/architecture/components">
    Understand the classes, interfaces, and their relationships
  </Card>
  <Card icon={<Target />} title="Usage Patterns" href="/architecture/patterns">
    Learn when and how to use each pattern with examples and decision trees
  </Card>
  <Card icon={<GitBranch />} title="Sequence Diagrams" href="/architecture/sequences">
    See detailed interaction flows between components
  </Card>
  <Card icon={<Wrench />} title="Extending" href="/architecture/extending">
    Add support for new app types with the extension guide
  </Card>
</Cards>

## Additional Resources

- **[Quick Reference](/architecture/quick-reference)** - Quick reference card for common tasks
- **[Architecture Diagram](/architecture/diagram)** - Detailed system architecture diagram
- **[Getting Started Guide](/guide/getting-started)** - Complete usage guide
- **[Example Tests](https://github.com/deepakkamboj/playwright-power-platform-toolkit/tree/main/packages/e2e-tests/tests)** - Runnable example tests
- **[API Reference](/reference)** - Complete API documentation

---

**Architecture Status**: ✅ Production Ready

Last Updated: January 2026
